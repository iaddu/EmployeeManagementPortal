<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Request Data</title>
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 4px;
    }

    th {
        background-color: #f2f2f2;
    }
    .button-column {
        width: 100px;
    }

    .button {
        padding: 4px;
        font-size:20px;
        background-color:aqua;
    }
    .button:hover {
	background-color:green;
}
</style>
</head>
<body>
<h2>Request Data <button class="button" onclick="window.location.href='/adminfiles/html/adminHome.html'">Back</button></h2>
<table id="requestTable">
    <thead>
        <tr>
            <th style="width: 20px;">ID</th>
            <th style="width: 40px;">Manager ID</th>
            <th style="width: 40px;">Employee ID</th>
            <th style="width: 40px;">Project ID</th>
            <th style="width: 80px;">Request Status</th>
            <th style="width: 80px;">To Status</th>
            <th class="button-column">Accept</th>
            <th class="button-column">Reject</th>
        </tr>
    </thead>
    <tbody id="requestTableBody">
        <!-- Table body content will be filled dynamically -->
    </tbody>
</table>

<script>
    fetch('/admin/getAllRequest')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('requestTableBody');
            data.forEach(request => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${request.reqId}</td>
                    <td>${request.managerId}</td>
                    <td>${request.empId}</td>
                    <td>${request.proId}</td>
                    <td>${request.reqStatus}</td>
                    <td>${request.toStatus}</td>
                    <td><button class="button" onclick="handleAccept(${request.reqId},${request.managerId}, ${request.empId}, ${request.proId}, '${request.toStatus}')">Accept</button></td>
                    <td><button class="button" onclick="handleReject(${request.reqId})">Reject</button></td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(error => console.error('Error fetching data:', error));

    function handleAccept(reqId,managerId, empId, proId, toStatus) {
        if (toStatus === 'assign') {
            acceptAssign(reqId,proId, managerId, empId);
        } else if (toStatus === 'unassign') {
            acceptUnassign(reqId,proId, managerId, empId);
        }
    }

    function handleReject(reqId) {
        const requestData = { reqId: reqId };

        fetch('/admin/rejectRequest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
        .then(response => {
            if (response.ok) {
                console.log('POST request to /admin/rejectRequest successful');
            } else {
                console.error('Error in POST request:', response.statusText);
            }
        })
        .catch(error => console.error('Error in POST request:', error));
    }

    function acceptAssign(reqId,proId, managerId, empId) {
        const requestData = { reqId:reqId,proId: proId, managerId: managerId, empId: empId };

        fetch('/admin/assignRequest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
        .then(response => {
            if (response.ok) {
                console.log('POST request to /admin/assignRequest successful');
            } else {
                console.error('Error in POST request:', response.statusText);
            }
        })
        .catch(error => console.error('Error in POST request:', error));
    }

    function acceptUnassign(reqId,proId, managerId, empId) {
        const requestData = {reqId:reqId, proId: proId, managerId: managerId, empId: empId };

        fetch('/admin/unassignRequest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
        .then(response => {
            if (response.ok) {
                console.log('POST request to /admin/unassignRequest successful');
            } else {
                console.error('Error in POST request:', response.statusText);
            }
        })
        .catch(error => console.error('Error in POST request:', error));
    }
</script>
</body>
</html>
